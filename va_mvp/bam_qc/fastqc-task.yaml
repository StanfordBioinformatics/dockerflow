name: Fastqc
description: Run samtools index on a bam file

inputParameters:
- name: input_bam
#- name: bam_basename
#- name: output_path

#outputParameters:
#- name: fastqc_zip
#  defaultValue: "${bam_basename}_fastqc.zip"
#  type: file
#- name: fastqc_html
#  defaultValue: "${bam_basename}_fastqc.html"
#  type: file

resources:
  minimumCpuCores: 1
  minimumRamGb: 4

docker:
  imageName: 'gcr.io/gbsc-gcp-project-mvp/fastqc:1.01'
  cmd: |
    source ~/.bashrc
    gsutil cp ${input_bam} ./
    local_file=$(basename ${input_bam})
    fastqc ${local_file}
    bam_basename=$(basename ${input_bam} .bam)
    output_path=$(dirname ${input_bam})
    unzip ${bam_basename}_fastqc.zip
    gsutil cp -r ${bam_basename}_fastqc ${output_path}
    gsutil cp ${bam_basename}_fastqc.html ${output_path}
